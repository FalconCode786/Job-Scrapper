<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobMatch AI - Intelligent CV Analysis</title>
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                    },
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                    keyframes: {
                        "accordion-down": {
                            from: { height: "0" },
                            to: { height: "var(--radix-accordion-content-height)" },
                        },
                        "accordion-up": {
                            from: { height: "var(--radix-accordion-content-height)" },
                            to: { height: "0" },
                        },
                        "fade-in": {
                            from: { opacity: "0", transform: "translateY(10px)" },
                            to: { opacity: "1", transform: "translateY(0)" },
                        },
                        "fade-out": {
                            from: { opacity: "1", transform: "translateY(0)" },
                            to: { opacity: "0", transform: "translateY(10px)" },
                        },
                        "slide-in-right": {
                            from: { transform: "translateX(100%)" },
                            to: { transform: "translateX(0)" },
                        },
                        "slide-in-bottom": {
                            from: { opacity: "0", transform: "translateY(20px)" },
                            to: { opacity: "1", transform: "translateY(0)" },
                        },
                        "pulse-slow": {
                            "0%, 100%": { opacity: "1" },
                            "50%": { opacity: ".5" },
                        },
                        "spin-slow": {
                            from: { transform: "rotate(0deg)" },
                            to: { transform: "rotate(360deg)" },
                        },
                    },
                    animation: {
                        "accordion-down": "accordion-down 0.2s ease-out",
                        "accordion-up": "accordion-up 0.2s ease-out",
                        "fade-in": "fade-in 0.3s ease-out",
                        "fade-out": "fade-out 0.2s ease-out",
                        "slide-in-right": "slide-in-right 0.3s ease-out",
                        "slide-in-bottom": "slide-in-bottom 0.4s ease-out",
                        "pulse-slow": "pulse-slow 3s ease-in-out infinite",
                        "spin-slow": "spin-slow 3s linear infinite",
                    },
                },
            },
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer base {
            :root {
                --background: 0 0% 100%;
                --foreground: 240 10% 3.9%;
                --card: 0 0% 100%;
                --card-foreground: 240 10% 3.9%;
                --popover: 0 0% 100%;
                --popover-foreground: 240 10% 3.9%;
                --primary: 240 5.9% 10%;
                --primary-foreground: 0 0% 98%;
                --secondary: 240 4.8% 95.9%;
                --secondary-foreground: 240 5.9% 10%;
                --muted: 240 4.8% 95.9%;
                --muted-foreground: 240 3.8% 46.1%;
                --accent: 240 4.8% 95.9%;
                --accent-foreground: 240 5.9% 10%;
                --destructive: 0 84.2% 60.2%;
                --destructive-foreground: 0 0% 98%;
                --border: 240 5.9% 90%;
                --input: 240 5.9% 90%;
                --ring: 240 5.9% 10%;
                --radius: 0.75rem;
                
                /* Custom success/warning colors */
                --success: 142.1 76.2% 36.3%;
                --success-foreground: 355.7 100% 97.3%;
                --warning: 38 92% 50%;
                --warning-foreground: 48 100% 96%;
            }

            .dark {
                --background: 240 10% 3.9%;
                --foreground: 0 0% 98%;
                --card: 240 10% 3.9%;
                --card-foreground: 0 0% 100%;
                --popover: 240 10% 3.9%;
                --popover-foreground: 0 0% 98%;
                --primary: 0 0% 98%;
                --primary-foreground: 240 5.9% 10%;
                --secondary: 240 3.7% 15.9%;
                --secondary-foreground: 0 0% 98%;
                --muted: 240 3.7% 15.9%;
                --muted-foreground: 240 5% 64.9%;
                --accent: 240 3.7% 15.9%;
                --accent-foreground: 0 0% 98%;
                --destructive: 0 62.8% 30.6%;
                --destructive-foreground: 0 0% 98%;
                --border: 240 3.7% 15.9%;
                --input: 240 3.7% 15.9%;
                --ring: 240 4.9% 83.9%;
                --success: 142.1 70.6% 45.3%;
                --success-foreground: 144.9 80.4% 10%;
                --warning: 38 92% 50%;
                --warning-foreground: 48 100% 96%;
            }
        }

        @layer base {
            * {
                @apply border-border;
            }
            body {
                @apply bg-background text-foreground font-sans antialiased;
                font-feature-settings: "rlig" 1, "calt" 1;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: hsl(var(--muted));
        }
        ::-webkit-scrollbar-thumb {
            background: hsl(var(--muted-foreground) / 0.3);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: hsl(var(--muted-foreground) / 0.5);
        }

        /* Glassmorphism utilities */
        .glass {
            @apply bg-white/70 dark:bg-black/50 backdrop-blur-xl border border-white/20 dark:border-white/10;
        }
        
        .glass-card {
            @apply bg-card/80 backdrop-blur-md border border-border/50 shadow-lg;
        }

        /* Animated gradient background */
        .animated-gradient {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Mesh gradient overlay */
        .mesh-bg {
            background-color: hsl(var(--background));
            background-image: 
                radial-gradient(at 0% 0%, hsl(var(--primary) / 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, hsl(var(--secondary) / 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, hsl(var(--accent) / 0.15) 0px, transparent 50%),
                radial-gradient(at 0% 100%, hsl(var(--muted) / 0.15) 0px, transparent 50%);
            filter: blur(60px);
        }

        /* Focus visible ring */
        .focus-ring {
            @apply focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background;
        }

        /* Loading skeleton */
        .skeleton {
            @apply animate-pulse bg-muted rounded-md;
        }

        /* Smooth transitions */
        .transition-theme {
            @apply transition-colors duration-300 ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen relative transition-theme">

    <!-- Theme Toggle -->
    <div class="fixed top-4 right-4 z-50">
        <button 
            id="theme-toggle" 
            onclick="toggleTheme()"
            class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-background border border-border shadow-sm hover:bg-accent hover:text-accent-foreground focus-ring transition-all"
            aria-label="Toggle theme"
        >
            <!-- Sun icon -->
            <svg id="sun-icon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="4" stroke-width="2"></circle>
                <path d="m12 2-2 2m2-2 2 2M2 12l2-2m-2 2 2 2m18-2-2-2m2 2-2 2m-8 8-2-2m2 2 2-2" stroke-width="2" stroke-linecap="round"></path>
            </svg>
            <!-- Moon icon -->
            <svg id="moon-icon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </div>

    <!-- Background -->
    <div class="fixed inset-0 mesh-bg -z-10 opacity-50"></div>
    <div class="fixed inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px] -z-10"></div>

    <!-- Header -->
    <header class="sticky top-0 z-40 w-full border-b border-border/40 bg-background/80 backdrop-blur-lg supports-[backdrop-filter]:bg-background/60">
        <div class="container flex h-16 items-center justify-between px-4 md:px-8">
            <div class="flex items-center gap-3">
                <div class="relative flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-primary to-primary/80 text-primary-foreground shadow-lg">
                    <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="flex flex-col">
                    <span class="text-lg font-bold tracking-tight leading-none">JobMatch AI</span>
                    <span class="text-[10px] text-muted-foreground uppercase tracking-wider font-medium">Neural Analysis</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 md:px-8 py-8 max-w-7xl space-y-8">

        <!-- Upload Section -->
        <section id="upload-section" class="relative group">
            <div class="absolute -inset-1 bg-gradient-to-r from-primary/20 via-secondary/20 to-accent/20 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
            
            <div class="relative glass-card rounded-xl p-8 md:p-12 text-center space-y-6 animate-fade-in">
                <div class="mx-auto w-24 h-24 rounded-2xl bg-gradient-to-br from-primary/10 to-secondary/10 border border-border flex items-center justify-center mb-6 group-hover:scale-105 transition-transform duration-500">
                    <svg class="h-12 w-12 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 15V3m0 12-4-4m4 4 4-4M2 17l.621 2.485A2 2 0 0 0 4.561 21h14.878a2 2 0 0 0 1.94-1.515L22 17" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>

                <div class="space-y-2">
                    <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Upload your CV</h1>
                    <p class="text-muted-foreground text-lg max-w-md mx-auto">
                        Our AI extracts technical, general, and soft skills automatically. Supports PDF, DOCX, and TXT.
                    </p>
                </div>

                <div class="flex justify-center">
                    <label class="relative cursor-pointer group/btn">
                        <input type="file" class="sr-only" id="cv-file" accept=".pdf,.docx,.txt" onchange="handleUpload(this)">
                        <div class="inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-6 py-3 text-sm font-medium text-primary-foreground shadow-lg shadow-primary/20 hover:bg-primary/90 focus-ring transition-all hover:scale-105 active:scale-95">
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke-linecap="round"/>
                                <polyline points="17 8 12 3 7 8" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="12" y1="3" x2="12" y2="15" stroke-linecap="round"/>
                            </svg>
                            Select Resume
                        </div>
                    </label>
                </div>

                <!-- Drag overlay -->
                <div id="drop-zone" class="absolute inset-0 rounded-xl border-2 border-dashed border-primary/50 bg-primary/5 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity flex items-center justify-center">
                    <span class="text-primary font-medium text-lg">Drop your file here</span>
                </div>
            </div>
        </section>

        <!-- Analysis Results -->
        <section id="cv-results" class="hidden animate-slide-in-bottom">
            <div class="glass-card rounded-xl p-6 md:p-8 space-y-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 pb-6 border-b border-border">
                    <div class="flex items-center gap-4">
                        <div class="h-12 w-12 rounded-full bg-green-500/10 border border-green-500/20 flex items-center justify-center text-green-600 dark:text-green-400">
                            <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold tracking-tight">Analysis Complete</h2>
                            <p class="text-muted-foreground text-sm">Hierarchical skill extraction finished successfully</p>
                        </div>
                    </div>
                    <div id="category-badge" class="inline-flex items-center gap-2 rounded-full bg-primary/10 px-4 py-1.5 text-sm font-medium text-primary border border-primary/20">
                        <span>‚ö°</span>
                        <span>Technical Profile</span>
                    </div>
                </div>

                <div id="skills-container" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </section>

        <!-- Filters -->
        <section id="filters" class="animate-slide-in-bottom" style="animation-delay: 0.1s">
            <div class="glass-card rounded-xl p-4 md:p-6">
                <div class="flex flex-col md:flex-row gap-4 items-end">
                    <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4 w-full">
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">Work Type</label>
                            <select id="work-type" onchange="searchJobs()" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-theme">
                                <option value="all">All Positions</option>
                                <option value="true">üåê Remote Only</option>
                                <option value="false">üè¢ On-site Only</option>
                            </select>
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">Keywords</label>
                            <input type="text" id="keywords" placeholder="Add search terms..." oninput="debouncedSearch()" 
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 transition-theme">
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">Location</label>
                            <input type="text" id="location" placeholder="City or country..." oninput="debouncedSearch()" 
                                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 transition-theme">
                        </div>
                    </div>

                    <button onclick="searchJobs()" class="inline-flex h-10 w-10 items-center justify-center rounded-md bg-primary text-primary-foreground shadow hover:bg-primary/90 focus-ring transition-all hover:scale-105 active:scale-95 shrink-0">
                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <circle cx="11" cy="11" r="8" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="m21 21-4.35-4.35" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="sr-only">Search</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Results Header -->
        <div id="results-header" class="hidden flex flex-col sm:flex-row sm:items-center justify-between gap-4 animate-fade-in">
            <h2 class="text-2xl font-bold tracking-tight">Matching Opportunities</h2>
            <div id="query-display" class="inline-flex items-center gap-2 rounded-full bg-secondary px-4 py-1.5 text-sm font-medium text-secondary-foreground">
                <svg class="h-4 w-4 text-muted-foreground" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <span id="query-text">Searching...</span>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden py-12">
            <div class="flex flex-col items-center justify-center gap-4">
                <div class="relative h-12 w-12">
                    <div class="absolute inset-0 rounded-full border-2 border-muted border-t-primary animate-spin"></div>
                    <div class="absolute inset-2 rounded-full border-2 border-muted border-t-secondary animate-spin" style="animation-duration: 1.5s; animation-direction: reverse;"></div>
                </div>
                <p class="text-sm text-muted-foreground animate-pulse">Matching your profile...</p>
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden py-16 text-center animate-fade-in">
            <div class="mx-auto h-32 w-32 rounded-full bg-muted flex items-center justify-center mb-6 text-4xl">
                üîç
            </div>
            <h3 class="text-xl font-semibold tracking-tight mb-2">No matches found</h3>
            <p class="text-muted-foreground max-w-sm mx-auto">Try adjusting your filters or uploading a different CV to see more results.</p>
        </div>

        <!-- Jobs Grid -->
        <div id="jobs-container" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            <!-- Dynamically populated -->
        </div>

    </main>

    <script>
        // Theme Management
        function getInitialTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                return 'dark';
            }
            return 'light';
        }

        function setTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            }
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            setTheme(isDark ? 'light' : 'dark');
        }

        // Initialize theme
        setTheme(getInitialTheme());

        // Drag and Drop
        const uploadSection = document.getElementById('upload-section');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('cv-file');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadSection.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadSection.addEventListener(eventName, () => {
                dropZone.classList.remove('opacity-0', 'pointer-events-none');
                dropZone.classList.add('opacity-100');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadSection.addEventListener(eventName, () => {
                dropZone.classList.add('opacity-0', 'pointer-events-none');
                dropZone.classList.remove('opacity-100');
            }, false);
        });

        uploadSection.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length) {
                fileInput.files = files;
                handleUpload(fileInput);
            }
        }

        let debounceTimer;
        function debouncedSearch() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(searchJobs, 400);
        }

        async function handleUpload(input) {
            const file = input.files[0];
            if (!file) return;

            const btn = input.closest('label');
            btn.classList.add('opacity-50', 'pointer-events-none');

            const formData = new FormData();
            formData.append('file', file);

            try {
                const res = await fetch('/api/upload-cv', { method: 'POST', body: formData });
                const data = await res.json();
                
                if (data.success) {
                    showCVResults(data);
                    searchJobs();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (err) {
                alert('Upload failed: ' + err.message);
            } finally {
                btn.classList.remove('opacity-50', 'pointer-events-none');
            }
        }

        function showCVResults(data) {
            document.getElementById('cv-results').classList.remove('hidden');
            
            const badge = document.getElementById('category-badge');
            const categories = {
                'technical': { text: 'Technical Profile', icon: '‚ö°' },
                'soft': { text: 'Soft Skills Profile', icon: 'ü§ù' },
                'general': { text: 'General Profile', icon: 'üéØ' }
            };
            const cat = categories[data.primary_category] || categories['general'];
            badge.innerHTML = `<span>${cat.icon}</span><span>${cat.text}</span>`;

            const container = document.getElementById('skills-container');
            container.innerHTML = '';

            const skillGroups = [
                { key: 'technical_skills', label: 'Technical Skills', icon: 'üíª', color: 'blue' },
                { key: 'general_skills', label: 'General Skills', icon: 'üõ†Ô∏è', color: 'amber' },
                { key: 'soft_skills', label: 'Soft Skills', icon: 'üåü', color: 'pink' }
            ];

            skillGroups.forEach(group => {
                const skills = data[group.key] || [];
                if (skills.length === 0) return;

                const card = document.createElement('div');
                card.className = 'rounded-lg border bg-card p-5 shadow-sm transition-all hover:shadow-md hover:border-primary/20';
                
                const colorClasses = {
                    blue: 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800',
                    amber: 'text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800',
                    pink: 'text-pink-600 dark:text-pink-400 bg-pink-50 dark:bg-pink-950/30 border-pink-200 dark:border-pink-800'
                };

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <span class="text-lg">${group.icon}</span>
                            <h3 class="font-semibold tracking-tight">${group.label}</h3>
                        </div>
                        <span class="text-xs font-medium px-2 py-1 rounded-full bg-secondary text-secondary-foreground">${skills.length}</span>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        ${skills.map(skill => `
                            <span class="inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-medium ring-1 ring-inset ${colorClasses[group.color]}">
                                ${skill}
                            </span>
                        `).join('')}
                    </div>
                `;
                container.appendChild(card);
            });

            if (data.experience_years > 0) {
                const expCard = document.createElement('div');
                expCard.className = 'rounded-lg border bg-gradient-to-br from-primary/5 to-secondary/5 p-5 shadow-sm md:col-span-full lg:col-span-1';
                expCard.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center text-xl">‚≠ê</div>
                        <div>
                            <p class="text-sm text-muted-foreground font-medium">Professional Experience</p>
                            <p class="text-2xl font-bold tracking-tight">${data.experience_years} Years</p>
                        </div>
                    </div>
                `;
                container.appendChild(expCard);
            }

            document.getElementById('cv-results').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        async function searchJobs() {
            const loading = document.getElementById('loading');
            const container = document.getElementById('jobs-container');
            const empty = document.getElementById('empty-state');
            const resultsHeader = document.getElementById('results-header');
            const queryDisplay = document.getElementById('query-text');

            loading.classList.remove('hidden');
            container.innerHTML = '';
            empty.classList.add('hidden');
            resultsHeader.classList.add('hidden');

            const params = new URLSearchParams({
                remote: document.getElementById('work-type').value,
                location: document.getElementById('location').value,
                query: document.getElementById('keywords').value
            });

            try {
                const res = await fetch(`/api/jobs?${params}`);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();

                loading.classList.add('hidden');
                resultsHeader.classList.remove('hidden');

                if (data.search_query_used) {
                    const terms = data.search_query_used.split(' ').slice(0, 3).join(', ');
                    queryDisplay.textContent = `${terms} ‚Ä¢ ${data.count} jobs`;
                }

                if (data.jobs.length === 0) {
                    empty.classList.remove('hidden');
                    return;
                }

                data.jobs.forEach((job, idx) => {
                    setTimeout(() => {
                        container.appendChild(createJobCard(job));
                    }, idx * 100);
                });
            } catch (error) {
                console.error('Search error:', error);
                loading.classList.add('hidden');
                empty.classList.remove('hidden');
            }
        }

        function createJobCard(job) {
            const card = document.createElement('div');
            card.className = 'group relative rounded-xl border bg-card text-card-foreground shadow transition-all hover:shadow-lg hover:border-primary/20 animate-fade-in';
            
            const score = job.match_score || 0;
            const scoreColor = score >= 75 ? 'text-green-600 dark:text-green-400 border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/30' : 
                              score >= 50 ? 'text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-950/30' : 
                              'text-red-600 dark:text-red-400 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-950/30';

            const tagsHtml = (job.tags || []).slice(0, 5).map(tag => 
                `<span class="inline-flex items-center rounded-md bg-secondary px-2 py-1 text-xs font-medium text-secondary-foreground ring-1 ring-inset ring-secondary/20">${tag}</span>`
            ).join('');

            const remoteBadge = job.remote ?
                `<span class="inline-flex items-center gap-1 rounded-full bg-green-50 dark:bg-green-950/30 px-2.5 py-0.5 text-xs font-medium text-green-700 dark:text-green-400 ring-1 ring-inset ring-green-600/20">üåê Remote</span>` :
                `<span class="inline-flex items-center gap-1 rounded-full bg-blue-50 dark:bg-blue-950/30 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:text-blue-400 ring-1 ring-inset ring-blue-700/10">üè¢ On-site</span>`;

            const visaBadge = job.visa_sponsorship ? 
                `<span class="inline-flex items-center gap-1 rounded-full bg-purple-50 dark:bg-purple-950/30 px-2.5 py-0.5 text-xs font-medium text-purple-700 dark:text-purple-400 ring-1 ring-inset ring-purple-700/10">üõÇ Visa</span>` : '';

            card.innerHTML = `
                <div class="p-6 space-y-4">
                    <div class="flex items-start justify-between">
                        <div class="space-y-1 pr-16">
                            <h3 class="font-semibold leading-tight tracking-tight text-lg line-clamp-2">${job.title || 'Unknown Position'}</h3>
                            <div class="flex items-center gap-2 text-sm text-muted-foreground">
                                <span class="font-medium text-foreground">${job.company || 'Unknown Company'}</span>
                            </div>
                        </div>
                        <div class="absolute top-4 right-4 flex flex-col items-center">
                            <div class="h-14 w-14 rounded-full border-2 flex items-center justify-center text-lg font-bold ${scoreColor}">
                                ${Math.round(score)}
                            </div>
                            <span class="text-[10px] font-medium text-muted-foreground uppercase tracking-wider mt-1">Match</span>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2">
                        ${remoteBadge}
                        ${visaBadge}
                        <span class="inline-flex items-center rounded-full bg-muted px-2.5 py-0.5 text-xs font-medium text-muted-foreground">üì° ${job.source || 'Job Board'}</span>
                    </div>

                    <p class="text-sm text-muted-foreground line-clamp-3 leading-relaxed">${job.description || ''}</p>

                    <div class="flex flex-wrap gap-2">
                        ${tagsHtml}
                    </div>

                    <div class="flex items-center justify-between pt-4 border-t border-border">
                        <div class="flex items-center gap-1.5 text-sm text-muted-foreground">
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="10" r="3" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span class="truncate max-w-[150px]">${job.location || 'Not specified'}</span>
                        </div>
                        <a href="${job.url || '#'}" target="_blank" 
                           class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2 gap-2 shadow-sm hover:shadow-md hover:scale-105 active:scale-95 transition-all">
                            Apply
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="m12 5 7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </a>
                    </div>

                    ${job.salary ? `<div class="pt-2 text-sm font-semibold text-green-600 dark:text-green-400">üí∞ ${job.salary}</div>` : ''}
                </div>
            `;

            return card;
        }

        // Initial search
        searchJobs();
    </script>
</body>
</html>